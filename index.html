<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lego-Chain English | CorreÃ§Ã£o de Bra-glish</title>
    <!-- Load Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons via CDN -->
    <script type="module">
        import { createIcons, Zap, CheckCircle, XCircle, ArrowRight, UserCheck, Blocks } from 'https://unpkg.com/lucide@latest/dist/esm/lucide.js';
        window.lucide = { createIcons, Zap, CheckCircle, XCircle, ArrowRight, UserCheck, Blocks };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* bg-gray-50 */
        }
        .block-chain-container {
            scroll-margin-top: 8rem; /* Para o scroll se ajustar ao cabeÃ§alho fixo */
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="app">
        <!-- ConteÃºdo serÃ¡ renderizado aqui -->
    </div>

    <script>
        // --- DATA: LESSON BLOCKS (O NOSSO "BLOCK CHAIN") ---

        const lessonBlocks = [
          {
            title: "Bloco 1: Casa e Estrutura (Storey vs. Floor)",
            concepts: [
              {
                english: "I live in a one-storey house.",
                portuguese: "Eu moro em uma casa de um andar (ou pavimento).",
                culturalNote: "Esta Ã© a armadilha da traduÃ§Ã£o literal de 'andar'. Em portuguÃªs, usamos 'andar' tanto para o pavimento ('casa de um andar') quanto para a localizaÃ§Ã£o ('no segundo andar'). Em inglÃªs, a palavra **'storey'** (ou 'story' nos EUA) Ã© a mais comum para o *pavimento*, a caracterÃ­stica do prÃ©dio. **'Floor'** Ã© a *localizaÃ§Ã£o* (o andar onde vocÃª estÃ¡).",
                sourceSentences: ["2. I live in a house of one storey", "3. I live in a one-storey house"],
              },
              {
                english: "I have a backyard of my house.",
                portuguese: "Eu tenho um quintal na minha casa.",
                culturalNote: "O erro original (Sent. 5) estÃ¡ na redundÃ¢ncia e na preposiÃ§Ã£o incorreta. 'I have a backyard' jÃ¡ basta. Use sempre **'backyard'** para o quintal de trÃ¡s da casa. **'Yard'** sozinho Ã© mais genÃ©rico (o gramado ou a Ã¡rea da frente).",
                sourceSentences: ["5. I have a backyard of my house"],
              }
            ],
            quiz: {
              question: "Escolha a palavra correta: Minha tia mora em um apartamento no dÃ©cimo ___.",
              options: [
                { text: "floor", correct: true },
                { text: "storey", correct: false, explanation: "'Storey' Ã© a caracterÃ­stica do prÃ©dio ('a ten-storey building'), nÃ£o a localizaÃ§Ã£o (o andar onde ela mora)." },
                { text: "ground", correct: false, explanation: "'Ground' (tÃ©rreo) nÃ£o se encaixa." }
              ],
              tip: "Lembre-se: 'storey' = caracterÃ­stica (o prÃ©dio tem), 'floor' = localizaÃ§Ã£o (eu estou)."
            }
          },
          {
            title: "Bloco 2: ComunicaÃ§Ã£o e Sentimentos (Idioms)",
            concepts: [
              {
                english: "I answer the phone / I pick up the phone.",
                portuguese: "Eu atendo o telefone.",
                culturalNote: "O erro vem da traduÃ§Ã£o literal de 'atender' como 'attend'. Em inglÃªs, **'attend'** Ã© 'participar/estar presente' (e.g., 'attend a meeting'). Para atender uma chamada, usamos **'I answer the phone'** ou **'I pick up the phone'**.",
                sourceSentences: ["12. The telephone rings. I answer or pick up the receiver or I attend the telephone."],
              },
              {
                english: "Why did you hang up on me / on my face?",
                portuguese: "Por que vocÃª desligou na minha cara?",
                culturalNote: "A traduÃ§Ã£o literal 'disconnect on my face' Ã© completamente estranha. A expressÃ£o correta Ã© **'to hang up on someone's face'** ou, mais comumente, apenas **'to hang up on me'** (desligar na minha cara/comigo). O verbo 'disconnect' Ã© tÃ©cnico, nÃ£o conversacional.",
                sourceSentences: ["14. Why did you hang up or disconnect on my face."],
              },
              {
                english: "You are a pain in the neck.",
                portuguese: "VocÃª Ã© um estorvo / um chato.",
                culturalNote: "Esta Ã© uma expressÃ£o idiomÃ¡tica muito usada que nÃ£o tem nada a ver com a palavra 'estorvo' ou 'chato'. Literalmente 'dor no pescoÃ§o', esta Ã© uma maneira educada (mas firme) de dizer que alguÃ©m Ã© irritante ou problemÃ¡tico.",
                sourceSentences: ["32. You are a pain in the neck."],
              }
            ],
            quiz: {
              question: "Qual o melhor sinÃ´nimo para 'I am starving' (da lista)?",
              options: [
                { text: "I am thirsty", correct: false, explanation: "Thirsty significa 'com sede'." },
                { text: "I can eat a horse", correct: true },
                { text: "I need to recharge the battery", correct: false, explanation: "Isso Ã© 'recarregar a bateria'." }
              ],
              tip: "Os falantes nativos usam 'I'm starving' (Estou morrendo de fome) o tempo todo!"
            }
          },
          {
            title: "Bloco 3: Falsos Amigos e VariaÃ§Ãµes (False Cognates)",
            concepts: [
              {
                english: "The bus conductor is playing politics with me.",
                portuguese: "O cobrador de Ã´nibus estÃ¡ fazendo politicagem comigo.",
                culturalNote: "O termo 'doing his politics' Ã© resultado de uma traduÃ§Ã£o direta. Em inglÃªs, use **'playing politics'** (jogando politicagem, fazendo polÃ­tica interna) ou 'getting involved in politics'. **'Politics'** geralmente se refere ao sistema governamental.",
                sourceSentences: ["48. The bus conductor is doing his politics with me.", "49. Stop with your politics at work."],
              },
              {
                english: "Alto de Pinheiros is a posh place to live.",
                portuguese: "Alto de Pinheiros Ã© um lugar chique e elegante para morar.",
                culturalNote: "O erro estÃ¡ em usar 'poshy', que nÃ£o existe. A palavra Ã© **'posh'** (BritÃ¢nico) ou **'swanky'** (Americano), que significam 'elegante' ou 'luxuoso' (e.g., 'a posh neighborhood').",
                sourceSentences: ["22. Alto de Pinheiros is a chic and poshy place to live."],
              },
              {
                english: "My computer has a bug / there is a bug in my computer.",
                portuguese: "Meu computador estÃ¡ com um bug.",
                culturalNote: "Este Ã© um erro de Estrutura Verbal (Verbo + PreposiÃ§Ã£o). Em portuguÃªs dizemos 'estar com' (problema). Em inglÃªs, nÃ£o se usa **'to be with'** para problemas ou doenÃ§as. O correto Ã© **'to have'** ('ter') ou **'there is'** ('hÃ¡'). O computador *tem* um bug. O mesmo vale para SentenÃ§a 27: 'I have a stomach bug'.",
                sourceSentences: ["26. My computer is with a bug", "27. I am with a stomach bug."],
              }
            ],
            quiz: {
              question: "Traduza: 'O nosso relacionamento Ã© uma casa de cartas.' (Sent. 83)",
              options: [
                { text: "Our relationship is a house of papers.", correct: false, explanation: "Papers Ã© 'papÃ©is', nÃ£o cartas de baralho." },
                { text: "Our relation is a house of cards.", correct: true },
                { text: "Our relation has a bug.", correct: false, explanation: "Tem um erro de estrutura (Bug Ã© 'defeito')." }
              ],
              tip: "A expressÃ£o Ã© a mesma em inglÃªs: 'A house of cards' = algo frÃ¡gil (como o relacionamento)."
            }
          },
          {
            title: "Bloco 4: TrÃ¢nsito e Infraestrutura (Vida Urbana)",
            concepts: [
              {
                english: "Marginal Pinheiros is a nightmare for many drivers, especially when it rains.",
                portuguese: "A Marginal Pinheiros Ã© um pesadelo para muitos motoristas, especialmente quando chove.",
                culturalNote: "O erro comum Ã© usar 'special' (adjetivo) como advÃ©rbio. O correto Ã© **'especially'** ou **'particularly'** (advÃ©rbios). A palavra **'nightmare'** (pesadelo) Ã© uma Ã³tima forma de descrever o trÃ¢nsito.",
                sourceSentences: ["15. Marginal Pinheiros is a nightmare for many drivers, special when it rains."],
              },
              {
                english: "We need new bridges and overpasses to improve the road traffic flow.",
                portuguese: "Precisamos de novas pontes e viadutos para melhorar o fluxo do trÃ¡fego.",
                culturalNote: "O termo **'flies-over'** (Sent. 16) Ã© usado, mas **'overpasses'** (EUA) ou **'flyovers'** (Reino Unido) sÃ£o mais formais e comuns para viadutos. O 'road traffic flow' (fluxo de trÃ¡fego) estÃ¡ correto.",
                sourceSentences: ["16. We need new bridges and flies-over to improve the road traffic flow."],
              },
              {
                english: "Marginal Pinheiros is jammed, I need a shortcut to get home.",
                portuguese: "A Marginal Pinheiros estÃ¡ congestionada, preciso de um atalho para ir para casa.",
                culturalNote: "TraduÃ§Ã£o literal de 'curto-circuito' (short-circuit). Para atalho, use **'shortcut'** (uma palavra). **'Jammed'** (Sent. 54) significa que o trÃ¢nsito estÃ¡ parado ou engarrafado. **'To get home'** Ã© a forma mais natural de dizer 'ir para casa'.",
                sourceSentences: ["54. Marginal Pinheiros is jammed, I need a short-circuit to home."],
              }
            ],
            quiz: {
              question: "Qual palavra usamos para 'atalho' em inglÃªs?",
              options: [
                { text: "short-circuit", correct: false, explanation: "'Short-circuit' Ã© um termo elÃ©trico (curto-circuito)." },
                { text: "short-cut", correct: false, explanation: "Embora compreensÃ­vel, a forma correta Ã© 'shortcut' (uma palavra)." },
                { text: "shortcut", correct: true }
              ],
              tip: "Um 'shortcut' Ã© o caminho mais rÃ¡pido, um 'short-circuit' queima tudo!"
            }
          },
          {
            title: "Bloco 5: FinanÃ§as e Carreira (ExpressÃµes Profissionais)",
            concepts: [
              {
                english: "Facebook is a blue-chip company.",
                portuguese: "O Facebook Ã© uma empresa de primeira linha (com aÃ§Ãµes estÃ¡veis e de alto valor).",
                culturalNote: "Uma **'blue-chip'** Ã© uma aÃ§Ã£o de uma grande empresa financeiramente sÃ³lida e bem estabelecida (o 'padrÃ£o ouro'). O termo Ã© o mesmo que usamos em portuguÃªs.",
                sourceSentences: ["38. Facebook is a blue-chip."],
              },
              {
                english: "I need the blueprint of the building.",
                portuguese: "Eu preciso da planta baixa do prÃ©dio.",
                culturalNote: "**'Blueprint'** (Sent. 39) Ã© o termo padrÃ£o para planta, o projeto detalhado. NÃ£o Ã© apenas uma 'cÃ³pia azul' (literal). Ã‰ amplamente usado, inclusive para 'plano mestre' (e.g., 'the blueprint for success').",
                sourceSentences: ["39. I need the blue print of Facebook's building."],
              },
              {
                english: "I need to work overtime to boost production.",
                portuguese: "Eu preciso fazer hora extra para aumentar a produÃ§Ã£o.",
                culturalNote: "O erro aqui Ã© a expressÃ£o 'to push production' (Sent. 40), que Ã© estranha. **'Overtime'** Ã© hora extra. O verbo mais natural para 'aumentar/impulsionar' Ã© **'to boost production'** ou **'to increase output'**.",
                sourceSentences: ["40. I need to work overtime to push production."],
              },
              {
                english: "It is full credit to the staff.",
                portuguese: "O crÃ©dito Ã© todo da equipe (do staff).",
                culturalNote: "O erro tem duas partes: 1) O plural de 'staff' (equipe) Ã© 'staff' â€“ nÃ£o existe 'staffs'. 2) A forma mais idiomÃ¡tica de dar reconhecimento total Ã© **'It is full credit to...'** (O crÃ©dito Ã© todo para...).",
                sourceSentences: ["82. It is full credits for the staffs"],
              }
            ],
            quiz: {
              question: "O que significa 'I need to work overtime'?",
              options: [
                { text: "Eu preciso de tempo livre.", correct: false, explanation: "Significa tempo extra, nÃ£o livre." },
                { text: "Eu preciso fazer hora extra.", correct: true },
                { text: "Eu preciso adiar o trabalho.", correct: false, explanation: "Significa excesso de tempo de trabalho." }
              ],
              tip: "Lembre-se: 'over' = excesso, 'time' = tempo. Excesso de tempo de trabalho."
            }
          },
          {
            title: "Bloco 6: Marketing, LogÃ­stica e Detalhes",
            concepts: [
              {
                english: "The badge of my car is a lion.",
                portuguese: "O emblema do meu carro Ã© um leÃ£o.",
                culturalNote: "O erro estÃ¡ em usar a palavra 'emblem' (Sent. 17). Em inglÃªs, o sÃ­mbolo de um carro Ã© mais comumente chamado de **'badge'** (BritÃ¢nico) ou **'logo'**. **'Emblem'** Ã© aceitÃ¡vel, mas 'badge' Ã© mais especÃ­fico para carros.",
                sourceSentences: ["17. The emblem of my car is a lion. It is a Peugeot.", "18. The logo of my company is a lion."],
              },
              {
                english: "We are organising some banners, leaflets, pamphlets and handouts.",
                portuguese: "Estamos organizando alguns banners, folhetos, panfletos e *handouts* (materiais de distribuiÃ§Ã£o).",
                culturalNote: "A palavra **'hands-out'** (literal, com hÃ­fen) Ã© um erro comum de quem pensa em 'mÃ£o para fora'. O termo correto Ã© **'handouts'** (uma palavra) ou **'flyers'** / **'brochures'** para folhetos promocionais. Significa 'materiais distribuÃ­dos'.",
                sourceSentences: ["19. We are organising some banners, leaflets, pamphlets and hands-out."],
              },
              {
                english: "The car window is broken.",
                portuguese: "O vidro do meu carro estÃ¡ quebrado.",
                culturalNote: "O erro Ã© usar 'window pane' (Sent. 20), que se refere ao vidro de uma janela de casa. Para carros, use simplesmente **'car window'** (janela lateral) ou **'windshield'** (para-brisa).",
                sourceSentences: ["20. The window pane of my car is broken."],
              }
            ],
            quiz: {
              question: "Qual a palavra correta para 'folheto de distribuiÃ§Ã£o' no contexto de marketing?",
              options: [
                { text: "hands-out", correct: false, explanation: "NÃ£o Ã© a forma correta. O termo Ã© uma palavra sÃ³, sem o hÃ­fen." },
                { text: "handouts", correct: true },
                { text: "window pane", correct: false, explanation: "Isso se refere ao vidro da janela." }
              ],
              tip: "Pense em 'entregas de mÃ£o' (handouts), nÃ£o em 'mÃ£os para fora' (hands-out)."
            }
          },
          {
            title: "Bloco 7: LogÃ­stica, FinanÃ§as Pessoais e Respeito",
            concepts: [
              {
                english: "I visited the grave of my late father at the graveyard.",
                portuguese: "Eu visitei o tÃºmulo do meu falecido pai no cemitÃ©rio.",
                culturalNote: "O termo **'late'** (Sent. 6) Ã© a forma correta de se referir a alguÃ©m que faleceu ('meu falecido pai'). **'Graveyard'** Ã© correto, mas **'cemetery'** Ã© mais formal e comum. NÃ£o hÃ¡ grande erro, mas 'I visited my late father's **grave**' (o tÃºmulo) Ã© mais sucinto.",
                sourceSentences: ["6. I visited my late father at the graveyard"],
              },
              {
                english: "The pilot lost control of the airplane and went off course in the Amazon.",
                portuguese: "O piloto perdeu o controle do aviÃ£o e saiu de sua rota na AmazÃ´nia.",
                culturalNote: "O erro estÃ¡ em usar 'finished its course or itinerary' (Sent. 8), que Ã© traduÃ§Ã£o literal e estranha. O termo correto para desvio de rota inesperado Ã© **'went off course'** (saiu da rota) ou **'lost its course'**.",
                sourceSentences: ["8. The pilot lost control of the aeroplane and finished its course or itinerary in Amazon."],
              },
              {
                english: "The air freight is due on November 22, 2013.",
                portuguese: "O frete aÃ©reo deve ser pago (ou chegar) em 22 de novembro de 2013.",
                culturalNote: "**'Air freight'** (Sent. 9) Ã© o termo tÃ©cnico para frete aÃ©reo. **'Is due'** Ã© um termo de logÃ­stica/finanÃ§as que significa que algo Ã© esperado, estÃ¡ 'vencido' ou deve ser pago/entregue atÃ© aquela data. Esta frase estÃ¡ estruturalmente correta.",
                sourceSentences: ["9. The air freight is due on November 22, 2013."],
              },
              {
                english: "The condominium fee is expensive (or steep).",
                portuguese: "A taxa de condomÃ­nio Ã© cara.",
                culturalNote: "Esta Ã© uma traduÃ§Ã£o literal de 'caro'. No inglÃªs moderno, **'dear'** (Sent. 10) significa quase que exclusivamente 'querido/a' (Sent. 11). Para custo, o termo correto Ã© **'expensive'** ou a gÃ­ria **'steep'**.",
                sourceSentences: ["10. The condominium fee is dear.", "11. My dear friend John, how are you these days?"],
              }
            ],
            quiz: {
              question: "Qual o erro da frase: 'The condominium fee is dear'?",
              options: [
                { text: "O termo 'condominium fee' estÃ¡ errado.", correct: false, explanation: "O termo estÃ¡ correto." },
                { text: "'Dear' nÃ£o Ã© a palavra natural para 'caro' (custoso) hoje.", correct: true },
                { text: "A frase deveria usar 'cemetery' ao invÃ©s de 'graveyard'.", correct: false, explanation: "Essa confusÃ£o nÃ£o se aplica a esta frase." }
              ],
              tip: "Dear = Querido. Expensive/Steep = Caro."
            }
          },
          {
            title: "Bloco 8: VizinhanÃ§a e Vida Urbana (Ruas e Bairros)",
            concepts: [
              {
                english: "There are many puddles and potholes in the streets.",
                portuguese: "HÃ¡ muitas poÃ§as d'Ã¡gua e buracos nas ruas.",
                culturalNote: "O erro do 'Bra-glish' Ã© usar 'holes' (buracos genÃ©ricos) para buracos de rua. O correto Ã© **'potholes'** (buracos no asfalto). TambÃ©m, 'puddles of water' Ã© redundante, use apenas **'puddles'** (poÃ§as). A preposiÃ§Ã£o Ã© **'in the streets'** (US) ou **'on the road'.**",
                sourceSentences: ["21. There are lots of puddles of water and holes on the streets."],
              },
              {
                english: "Which neighborhood in SÃ£o Paulo are you from?",
                portuguese: "De qual bairro/regiÃ£o de SÃ£o Paulo vocÃª Ã©?",
                culturalNote: "NÃ£o traduza 'parte' literalmente (**'part'**). Em inglÃªs, para localizaÃ§Ã£o urbana, use **'neighborhood'** (bairro) ou **'area'** (regiÃ£o). A forma mais natural e comum Ã© 'Where are you from in X?' ou 'Which neighborhood are you from?'",
                sourceSentences: ["23. Which part of Sao Paolo, are you from?"],
              },
              {
                english: "I am at the gas station. I am filling up my tank.",
                portuguese: "Estou no posto de gasolina. Estou enchendo o tanque.",
                culturalNote: "Use **'gas station'** (EUA) ou **'petrol station'** (RU). Evite 'fuel station' para conversas casuais. A frase 'I am filling up my tank' (Sent. 25) estÃ¡ correta e Ã© nativa. NÃ£o use 'to fill in my tank' (Sent. 99 - erro de preposiÃ§Ã£o).",
                sourceSentences: ["24. I am at the gas / fuel / petrol station.", "25. I am filling up my tank."],
              }
            ],
            quiz: {
              question: "Qual o termo correto para 'buraco no asfalto'?",
              options: [
                { text: "road holes", correct: false, explanation: "'Road holes' Ã© compreensÃ­vel, mas 'pothole' Ã© o termo especÃ­fico e nativo." },
                { text: "potholes", correct: true },
                { text: "big cracks", correct: false, explanation: "'Cracks' sÃ£o rachaduras, nÃ£o buracos." }
              ],
              tip: "Pense no asfalto como uma 'panela' (pot) com um buraco: Pothole!"
            }
          }
        ];

        // --- GLOBAL STATE ---
        let currentBlockIndex = 0;
        let quizStates = lessonBlocks.map(() => ({
            answered: false,
            correct: null,
            selectedOption: null,
        }));

        // --- UTILITY FUNCTIONS ---

        function getIconSVG(name, classes) {
            const size = "w-6 h-6";
            const color = classes;
            // Uses Lucide icons (pre-loaded in <script type="module">)
            const icons = {
                Blocks: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${size} ${color}"><rect x="2" y="7" width="20" height="15" rx="2"/><path d="M17 2h3a2 2 0 0 1 2 2v3"/><path d="M7 2h3a2 2 0 0 0 2 2v3"/><path d="M10 2v3"/><path d="M7 2v3"/><path d="M17 2v3"/></svg>`,
                Zap: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${size} ${color}"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
                CheckCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${size} ${color}"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M9 11l3 3L22 4"/></svg>`,
                XCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${size} ${color}"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>`,
                ArrowRight: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${size} ${color}"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`,
                UserCheck: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${size} ${color}"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><path d="M19 8h6"/><path d="m22 3-6 6"/><circle cx="9" cy="7" r="4"/></svg>`,
            };
            return icons[name] || '';
        }

        function handleAnswer(blockIndex, optionIndex) {
            const block = lessonBlocks[blockIndex];
            const option = block.quiz.options[optionIndex];
            
            if (quizStates[blockIndex].answered) return;

            const isCorrect = option.correct;
            quizStates[blockIndex] = {
                answered: true,
                correct: isCorrect,
                selectedOption: option,
            };

            renderApp(); // Re-render the app to update the block UI

            if (isCorrect) {
                // Wait 1.5s before moving to the next block
                setTimeout(() => {
                    handleBlockCompletion(blockIndex);
                }, 1500);
            }
        }

        function handleBlockCompletion(blockIndex) {
            if (blockIndex === currentBlockIndex && quizStates[blockIndex].correct) {
                currentBlockIndex++;
                renderApp(); // Re-render the app to highlight the next block and scroll

                // Scroll to the new active block
                const activeBlockElement = document.getElementById(`block-${currentBlockIndex}`);
                if (activeBlockElement) {
                    activeBlockElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        // --- RENDER FUNCTIONS ---

        function renderBlock(block, index) {
            const isActive = index === currentBlockIndex;
            const state = quizStates[index];
            
            const IconName = state.correct === true ? 'CheckCircle' : state.correct === false ? 'XCircle' : 'Zap';
            const iconColor = state.correct === true ? "text-green-500" : state.correct === false ? "text-red-500" : "text-indigo-600";
            const statusText = state.correct === true ? "ParabÃ©ns! Bloco Conectado." : state.correct === false ? "Opa! Reveja a nota cultural." : "Teste seu entendimento";

            let conceptsHtml = block.concepts.map((concept, cIndex) => `
                <div class="p-4 bg-indigo-50 rounded-lg">
                    <p class="text-sm font-semibold text-indigo-700">ðŸ‡§ðŸ‡· PortuguÃªs (O que queremos dizer):</p>
                    <p class="text-xl italic text-gray-700 mb-2">"${concept.portuguese}"</p>
                    <p class="text-sm font-semibold text-indigo-700">ðŸ‡¬ðŸ‡§ English (A forma nativa):</p>
                    <p class="text-2xl font-bold text-gray-900 mb-3">"${concept.english}"</p>
                    <div class="mt-2 p-3 bg-indigo-100 rounded-md">
                        <p class="text-sm font-medium text-indigo-900">ðŸ’¡ Raiz do Erro / Lego (O PorquÃª da LiÃ§Ã£o):</p>
                        <p class="text-base text-indigo-900">${concept.culturalNote}</p>
                    </div>
                    <p class="text-xs mt-2 text-gray-500">SentenÃ§as de ReferÃªncia: ${concept.sourceSentences.join(", ")}</p>
                </div>
            `).join('');


            let optionsHtml = block.quiz.options.map((option, oIndex) => {
                let buttonClass = "bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 focus:ring-indigo-500";
                let disabled = '';

                if (state.answered) {
                    disabled = 'disabled';
                    if (option.correct) {
                        buttonClass = "bg-green-500 ring-4 ring-green-300 transform scale-105";
                    } else if (option === state.selectedOption) {
                        buttonClass = "bg-red-500 ring-4 ring-red-300 transform scale-105";
                    } else {
                        buttonClass = "bg-gray-400 cursor-not-allowed";
                    }
                }
                
                return `
                    <button
                        onclick="handleAnswer(${index}, ${oIndex})"
                        ${disabled}
                        class="p-4 text-white font-semibold rounded-xl transition duration-300 shadow-md transform hover:shadow-lg ${buttonClass} ${state.answered && !option.correct ? 'hover:shadow-none' : ''}"
                    >
                        ${option.text}
                    </button>
                `;
            }).join('');

            let quizFeedbackHtml = '';
            if (state.answered) {
                const feedbackClass = state.correct ? 'bg-green-100 border-2 border-green-500' : 'bg-red-100 border-2 border-red-500';
                const feedbackTitleClass = state.correct ? 'text-green-800' : 'text-red-800';
                const feedbackTitle = state.correct ? "Correto!" : "Incorreto!";
                
                let explanation = '';
                if (!state.correct) {
                    explanation = `
                        <p class="text-red-700 mt-2">
                            **RevisÃ£o:** ${state.selectedOption.explanation || "Tente novamente! Reveja a nota cultural acima."}
                        </p>
                    `;
                }
                
                let nextButton = '';
                if (state.correct) {
                    nextButton = `
                        <button
                            onclick="handleBlockCompletion(${index})"
                            class="mt-4 px-4 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 flex items-center transition duration-200"
                        >
                            PrÃ³ximo Bloco ${getIconSVG('ArrowRight', 'w-5 h-5 ml-2')}
                        </button>
                    `;
                }

                quizFeedbackHtml = `
                    <div class="mt-6 p-4 rounded-xl transition-opacity duration-500 ${feedbackClass}">
                        <p class="font-bold text-lg ${feedbackTitleClass}">
                            ${feedbackTitle}
                        </p>
                        ${explanation}
                        <p class="text-gray-700 mt-2">
                            **Dica do Professor:** ${block.quiz.tip}
                        </p>
                        ${nextButton}
                    </div>
                `;
            }

            const blockClass = isActive 
                ? 'bg-white border-4 border-indigo-300 transform scale-100' 
                : 'bg-gray-100 opacity-60 pointer-events-none';

            return `
                <div id="block-${index}" class="block-chain-container p-6 md:p-8 rounded-xl shadow-2xl transition-all duration-500 ${blockClass}">
                    <h3 class="text-3xl font-extrabold text-gray-900 mb-6 flex items-center">
                        ${getIconSVG('Blocks', 'w-8 h-8 text-indigo-500 mr-3')} ${block.title}
                    </h3>

                    <!-- CONCEITOS -->
                    <div class="space-y-6 mb-8 border-l-4 border-indigo-400 pl-4">
                        ${conceptsHtml}
                    </div>

                    <!-- EXERCÃCIO -->
                    <div class="mt-8 pt-6 border-t border-indigo-200">
                        <h4 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                            ${getIconSVG(IconName, `w-6 h-6 mr-2 ${iconColor}`)} ${statusText}
                        </h4>
                        
                        <p class="text-lg font-medium text-gray-700 mb-6">${block.quiz.question}</p>

                        <div class="grid md:grid-cols-3 gap-4">
                            ${optionsHtml}
                        </div>

                        ${quizFeedbackHtml}
                    </div>
                </div>
            `;
        }

        function renderApp() {
            const container = document.getElementById('app');
            const isComplete = currentBlockIndex >= lessonBlocks.length;
            const progressPercent = (currentBlockIndex / lessonBlocks.length) * 100;

            // HEADER
            const header = `
                <header class="bg-white shadow-lg sticky top-0 z-10">
                    <div class="max-w-4xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                        <h1 class="text-3xl font-extrabold text-indigo-700 flex items-center">
                            ${getIconSVG('Blocks', 'w-8 h-8 mr-2 text-indigo-500')}
                            Lego-Chain English
                        </h1>
                        <div class="flex items-center space-x-2">
                            ${getIconSVG('UserCheck', 'w-5 h-5 text-gray-500')}
                            <span class="text-sm font-medium text-gray-600">By Daby @2025</span>
                        </div>
                    </div>
                </header>
            `;
            
            // MAIN CONTENT START
            let mainContent = `
                <main class="max-w-4xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
                    
                    <!-- BOAS-VINDAS -->
                    <div class="bg-indigo-600 p-6 sm:p-8 rounded-2xl shadow-xl text-white mb-10">
                        <h2 class="text-3xl font-bold mb-3">Bem-vindo(a) Ã  sua jornada de inglÃªs!</h2>
                        <p class="text-lg opacity-90">
                            O objetivo deste curso Ã© consertar o **"Bra-glish"**, a traduÃ§Ã£o literal que nos impede de soar nativos. Lembre-se: todo grande prÃ©dio Ã© feito de pequenos e sÃ³lidos blocos. Vamos construir seu inglÃªs, bloco por bloco, garantindo que seu conhecimento fique **sÃ³lido e conectado**!
                        </p>
                        <div class="mt-4">
                            <p class="text-base font-semibold">Progresso Atual:</p>
                            <div class="w-full bg-indigo-500 rounded-full h-2.5 mt-1">
                                <div 
                                    class="bg-lime-300 h-2.5 rounded-full transition-all duration-700" 
                                    style="width: ${progressPercent}%"
                                    role="progressbar"
                                    aria-valuenow="${progressPercent}"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                ></div>
                            </div>
                            <p class="text-sm mt-1">${currentBlockIndex} de ${lessonBlocks.length} Blocos Conectados</p>
                        </div>
                    </div>

                    <!-- BLOCKS CONTAINER -->
                    <div class="space-y-8">
            `;

            // BLOCKS RENDERING
            mainContent += lessonBlocks.map((block, index) => {
                const blockHtml = renderBlock(block, index);
                
                let connectionLine = '';
                if (index > 0) {
                    const lineColor = index <= currentBlockIndex ? 'bg-lime-500' : 'bg-gray-300';
                    connectionLine = `
                        <div class="absolute -top-4 left-1/2 -ml-0.5 w-1 h-8 ${lineColor} transition-colors duration-500"></div>
                    `;
                }

                let completionIndicator = '';
                 if (index < lessonBlocks.length - 1) {
                    const indicatorClass = index < currentBlockIndex ? 'scale-100 opacity-100' : 'scale-0 opacity-0';
                    completionIndicator = `
                        <div class="flex justify-center -mb-4 mt-4 transition-transform duration-500 ${indicatorClass}">
                            ${getIconSVG('CheckCircle', 'w-6 h-6 text-lime-500 bg-white rounded-full z-[1]')}
                        </div>
                    `;
                }


                return `
                    <div key="${index}" id="block-container-${index}" class="relative">
                        ${connectionLine}
                        ${blockHtml}
                        ${completionIndicator}
                    </div>
                `;
            }).join('');

            mainContent += '</div>'; // close space-y-8 container

            // CONCLUSÃƒO
            if (isComplete) {
                mainContent += `
                    <div class="mt-12 p-8 bg-lime-500 rounded-2xl shadow-xl text-white text-center">
                        ${getIconSVG('CheckCircle', 'w-12 h-12 mx-auto mb-4')}
                        <h3 class="text-3xl font-bold mb-2">Jornada ConcluÃ­da!</h3>
                        <p class="text-xl">
                            ParabÃ©ns! VocÃª conectou todos os Blocos de Conhecimento. Seu Block Chain de inglÃªs estÃ¡ **sÃ³lido** e livre de 'Bra-glish'!
                        </p>
                        <p class="mt-4 text-base">
                            A repetiÃ§Ã£o Ã© a chave. Revise os blocos e continue construindo.
                        </p>
                    </div>
                `;
            }

            // FOOTER
            mainContent += `
                <footer class="mt-16 text-center text-sm text-gray-500 border-t pt-8">
                    <p>&copy; By Daby @2025. Lego-Chain Method. Aprender Ã© construir.</p>
                </footer>
            `;

            mainContent += '</main>'; // close main

            container.innerHTML = header + mainContent;
        }

        // Initialize the app on window load
        window.onload = function() {
            renderApp();
        };

        // Expose handleAnswer and handleBlockCompletion globally for button click handlers
        window.handleAnswer = handleAnswer;
        window.handleBlockCompletion = handleBlockCompletion;
        
    </script>
</body>
</html>
